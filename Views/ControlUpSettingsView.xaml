<UserControl x:Class="ControlUp.ControlUpSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:ControlUp"
             xmlns:controls="clr-namespace:ControlUp.Controls"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="650">

    <UserControl.Resources>
        <local:EnumDescriptionConverter x:Key="EnumDescriptionConverter"/>
        <ObjectDataProvider x:Key="NotificationPositions" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="local:NotificationPosition" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <ObjectDataProvider x:Key="ControllerHotkeys" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="local:ControllerHotkey" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <ObjectDataProvider x:Key="StylePresets" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="local:NotificationStylePreset" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </UserControl.Resources>

    <TabControl>
        <!-- General Tab -->
        <TabItem Header="General">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="ControlUp Settings" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                    <!-- Required Setting Warning -->
                    <Border Background="#3D2A1A"
                            BorderBrush="#FF9800"
                            BorderThickness="2"
                            CornerRadius="4"
                            Padding="12"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="&#x26A0; Required: Enable Controller Input in Playnite" FontWeight="Bold" Margin="0,0,0,8" Foreground="#FF9800"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0">
                                For ControlUp to properly work, enable controller input in Playnite:
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#FFD180" Margin="10,8,0,0" FontWeight="SemiBold">
                                Settings → Input → Enable "game controller API support"
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Description -->
                    <Border Background="#2D2D30"
                            BorderBrush="#3F3F46"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="12"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="How it works:" FontWeight="SemiBold" Margin="0,0,0,8" Foreground="#E0E0E0"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0">
                                When a game controller is connected while in Desktop mode, a popup will appear asking if you want to switch to Fullscreen mode. You can accept with the A button or cancel with B.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Connection Detection Section -->
                    <TextBlock Text="Controller Connection Detection" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Detection Mode:" Margin="0,0,0,5"/>
                            <TextBlock Text="Choose when to trigger the fullscreen popup." FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>
                            <ComboBox ItemsSource="{Binding AvailableTriggerModes}"
                                     SelectedItem="{Binding Settings.FullscreenTriggerMode}"
                                     Margin="0,0,0,10">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <CheckBox Content="Skip popup on connection (switch directly to fullscreen)"
                                     IsChecked="{Binding Settings.SkipPopupOnConnection}"
                                     Margin="0,10,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Hotkey Section -->
                    <TextBlock Text="Controller Hotkey" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Enable controller hotkey to trigger fullscreen"
                                     IsChecked="{Binding Settings.EnableHotkey}"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="Hotkey Combination:" Margin="0,5,0,5"/>
                            <TextBlock Text="Press this button combination to trigger the fullscreen popup." FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>
                            <ComboBox ItemsSource="{Binding Source={StaticResource ControllerHotkeys}}"
                                     SelectedItem="{Binding Settings.HotkeyCombo}"
                                     IsEnabled="{Binding Settings.EnableHotkey}"
                                     Margin="0,0,0,10">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <CheckBox Content="Skip popup on hotkey (switch directly to fullscreen)"
                                     IsChecked="{Binding Settings.SkipPopupOnHotkey}"
                                     IsEnabled="{Binding Settings.EnableHotkey}"
                                     Margin="0,10,0,0"/>

                            <CheckBox Content="Require long press instead of instant tap"
                                     IsChecked="{Binding Settings.RequireLongPress}"
                                     IsEnabled="{Binding Settings.EnableHotkey}"
                                     Margin="0,10,0,0"/>
                            <TextBlock Text="(Recommended for single-button hotkeys like Guide)" FontSize="11" Foreground="Gray" Margin="20,2,0,0"/>

                            <TextBlock Text="Long Press Duration:" Margin="0,15,0,5"/>
                            <TextBlock Text="How long to hold the hotkey for long press activation." FontSize="11" Foreground="Gray" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.LongPressDelayMs}"
                                        Minimum="300" Maximum="2000" Width="200"
                                        TickFrequency="100" IsSnapToTickEnabled="True"
                                        IsEnabled="{Binding LongPressSliderEnabled}"/>
                                <TextBlock Text="{Binding Settings.LongPressDelayMs, StringFormat={}{0} ms}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="60"/>
                                <TextBlock Text="{Binding LongPressDelaySeconds}"
                                          Margin="5,0,0,0" VerticalAlignment="Center" Foreground="Gray"/>
                            </StackPanel>

                            <TextBlock Text="Hotkey Cooldown:" Margin="0,15,0,5"/>
                            <TextBlock Text="Delay after popup closes before hotkey can trigger again. Set to 0 to allow rapid re-triggering." FontSize="11" Foreground="Gray" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.HotkeyCooldownMs}"
                                        Minimum="0" Maximum="5000" Width="200"
                                        TickFrequency="100" IsSnapToTickEnabled="True"
                                        IsEnabled="{Binding Settings.EnableHotkey}"/>
                                <TextBlock Text="{Binding Settings.HotkeyCooldownMs, StringFormat={}{0} ms}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="60"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Pop-Up Tab -->
        <TabItem Header="Pop-Up">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Pop-Up Appearance" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                    <!-- Style Presets Section -->
                    <TextBlock Text="Style Presets" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Quick Style:" Margin="0,0,0,5"/>
                            <TextBlock Text="Select a preset to quickly apply a color scheme with acrylic blur." FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>
                            <ComboBox ItemsSource="{Binding AvailableStylePresets}"
                                     SelectedItem="{Binding SelectedStylePreset}"
                                     Margin="0,0,0,5">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Text="Selecting a preset updates colors below. Use 'Custom' to keep manual changes." FontSize="10" Foreground="Gray" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Position Section -->
                    <TextBlock Text="Position" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Screen Position:" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Source={StaticResource NotificationPositions}}"
                                     SelectedItem="{Binding Settings.NotificationPosition}"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="Edge Margin:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.NotificationEdgeMargin}"
                                        Minimum="0" Maximum="100" Width="200"
                                        TickFrequency="10" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.NotificationEdgeMargin, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Size Section -->
                    <TextBlock Text="Size" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Width:" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.NotificationWidth}"
                                        Minimum="300" Maximum="800" Width="200"
                                        TickFrequency="50" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.NotificationWidth, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="60"/>
                            </StackPanel>

                            <TextBlock Text="Height:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.NotificationHeight}"
                                        Minimum="200" Maximum="500" Width="200"
                                        TickFrequency="50" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.NotificationHeight, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="60"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Timing Section -->
                    <TextBlock Text="Timing" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Auto-close Duration:" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.NotificationDurationSeconds}"
                                        Minimum="5" Maximum="30" Width="200"
                                        TickFrequency="5" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.NotificationDurationSeconds, StringFormat={}{0} sec}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Blur Section -->
                    <TextBlock Text="Blur Effect" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Enable Acrylic Blur Effect"
                                     IsChecked="{Binding Settings.EnableBlur}"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="Blur Mode:" Margin="0,5,0,5"/>
                            <ComboBox SelectedIndex="{Binding Settings.BlurMode}" Margin="0,0,0,10">
                                <ComboBoxItem Content="Basic Blur"/>
                                <ComboBoxItem Content="Acrylic Blur (Win10 1803+)"/>
                            </ComboBox>
                            <TextBlock Text="Acrylic blur provides a frosted glass effect. Basic blur is more compatible with older systems." FontSize="10" Foreground="Gray" Margin="0,0,0,5"/>

                            <TextBlock Text="Blur Opacity:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.BlurOpacity}"
                                        Minimum="0" Maximum="255" Width="200"/>
                                <TextBlock Text="{Binding Settings.BlurOpacity, StringFormat={}{0}}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>

                            <TextBlock Text="Blur Tint Color:" Margin="0,10,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.BlurTintColor}"/>

                        </StackPanel>
                    </Border>

                    <!-- Visual Section -->
                    <TextBlock Text="Visual Style" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Background Color:" Margin="0,0,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.BackgroundColor}"/>

                            <TextBlock Text="Background Opacity:" Margin="0,10,0,5"/>
                            <TextBlock Text="(Lower values show more blur)" FontSize="10" Foreground="Gray" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.BackgroundOpacity}"
                                        Minimum="0" Maximum="255" Width="200"/>
                                <TextBlock Text="{Binding Settings.BackgroundOpacity, StringFormat={}{0}}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>

                            <TextBlock Text="Border Color:" Margin="0,10,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.BorderColor}"/>

                            <TextBlock Text="Border Thickness:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.BorderThickness}"
                                        Minimum="0" Maximum="5" Width="200"
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>
                                <TextBlock Text="{Binding Settings.BorderThickness, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>

                            <TextBlock Text="Border Opacity:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.BorderOpacity}"
                                        Minimum="0" Maximum="255" Width="200"/>
                                <TextBlock Text="{Binding Settings.BorderOpacity, StringFormat={}{0}}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>

                            <TextBlock Text="Corner Radius:" Margin="0,10,0,5"/>
                            <TextBlock Text="Due to a bug in Windows' blur system, corner radius doesn't work with blur. If you want corner radius without dark corner artifacts, blur must be disabled." FontSize="10" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.CornerRadius}"
                                        Minimum="0" Maximum="32" Width="200"
                                        TickFrequency="4" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.CornerRadius, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Blur Window Padding Section -->
                    <TextBlock Text="Blur Window Padding" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Extra padding around the window to expand the blur effect area." FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,10"/>

                            <TextBlock Text="Padding:" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.BlurWindowPadding}"
                                        Minimum="0" Maximum="50" Width="200"
                                        TickFrequency="5" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.BlurWindowPadding, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Vignette Section -->
                    <TextBlock Text="Vignette Effect" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Enable vignette effect"
                                     IsChecked="{Binding Settings.EnableVignette}"
                                     Margin="0,0,0,10"/>
                            <TextBlock Text="Darkens the edges for a cinematic look." FontSize="10" Foreground="Gray" Margin="0,0,0,10"/>

                            <TextBlock Text="Vignette Color:" Margin="0,0,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.VignetteColor}"/>

                            <TextBlock Text="Vignette Opacity:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.VignetteOpacity}"
                                        Minimum="0" Maximum="255" Width="200"/>
                                <TextBlock Text="{Binding Settings.VignetteOpacity, StringFormat={}{0}}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>

                            <TextBlock Text="Vignette Size:" Margin="0,10,0,5"/>
                            <TextBlock Text="Smaller values create a tighter vignette effect." FontSize="10" Foreground="Gray" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.VignetteSize}"
                                        Minimum="50" Maximum="200" Width="200"
                                        TickFrequency="10" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.VignetteSize, StringFormat={}{0}}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Preview Button -->
                    <Button Content="Preview Notification"
                           Command="{Binding PreviewNotificationCommand}"
                           HorizontalAlignment="Left"
                           Padding="15,8"
                           Margin="0,10,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Toast Notifications Tab -->
        <TabItem Header="Toasts">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Toast Notifications" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                    <!-- Description -->
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="About Toast Notifications:" FontWeight="SemiBold" Margin="0,0,0,8" Foreground="#E0E0E0"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0">
                                Non-blocking notifications that appear briefly when actions occur (like auto-switching to fullscreen). These are separate from the confirmation popup dialog.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Enable Section -->
                    <TextBlock Text="General" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Enable toast notifications"
                                     IsChecked="{Binding Settings.EnableToastNotifications}"
                                     Margin="0,0,0,10"/>
                            <TextBlock Text="Show brief notifications when auto-switching occurs or other events happen." FontSize="11" Foreground="Gray" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- Style Presets Section -->
                    <TextBlock Text="Style Presets" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Quick Style:" Margin="0,0,0,5"/>
                            <TextBlock Text="Select a preset to quickly apply a color scheme with acrylic blur." FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>
                            <ComboBox ItemsSource="{Binding AvailableToastStylePresets}"
                                     SelectedItem="{Binding SelectedToastStylePreset}"
                                     Margin="0,0,0,5">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Text="Presets use blur opacity 40 or below to maximize the acrylic blur effect." FontSize="10" Foreground="Gray" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Position Section -->
                    <TextBlock Text="Position" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Screen Position:" Margin="0,0,0,5"/>
                            <ComboBox SelectedIndex="{Binding Settings.ToastPosition}" Margin="0,0,0,10">
                                <ComboBoxItem Content="Top Right"/>
                                <ComboBoxItem Content="Top Left"/>
                                <ComboBoxItem Content="Bottom Right"/>
                                <ComboBoxItem Content="Bottom Left"/>
                                <ComboBoxItem Content="Top Center"/>
                                <ComboBoxItem Content="Bottom Center"/>
                            </ComboBox>

                            <TextBlock Text="Edge Margin:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.ToastEdgeMargin}"
                                        Minimum="0" Maximum="100" Width="200"
                                        TickFrequency="10" IsSnapToTickEnabled="False"/>
                                <TextBlock Text="{Binding Settings.ToastEdgeMargin, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Size Section -->
                    <TextBlock Text="Size" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Width:" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.ToastWidth}"
                                        Minimum="200" Maximum="600" Width="200"
                                        TickFrequency="1" IsSnapToTickEnabled="True"
                                        SmallChange="1" LargeChange="10"/>
                                <TextBlock Text="{Binding Settings.ToastWidth, StringFormat={}{0:F0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="60"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Timing Section -->
                    <TextBlock Text="Timing" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Display Duration:" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.ToastDurationMs}"
                                        Minimum="1000" Maximum="10000" Width="200"
                                        TickFrequency="1000" IsSnapToTickEnabled="True"/>
                                <TextBlock Text="{Binding Settings.ToastDurationMs, StringFormat={}{0} ms}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="70"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Blur Section -->
                    <TextBlock Text="Blur Effect" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Enable blur effect"
                                     IsChecked="{Binding Settings.EnableToastBlur}"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="Blur Opacity:" Margin="0,5,0,5"/>
                            <TextBlock Text="Lower values (0-40) show more blur effect. Higher values are more opaque." FontSize="10" Foreground="Gray" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.ToastBlurOpacity}"
                                        Minimum="0" Maximum="255" Width="200"/>
                                <TextBlock Text="{Binding Settings.ToastBlurOpacity, StringFormat={}{0}}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>

                            <TextBlock Text="Blur Tint Color:" Margin="0,10,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.ToastBlurTintColor}"/>
                        </StackPanel>
                    </Border>

                    <!-- Border Section -->
                    <TextBlock Text="Border" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Border Color:" Margin="0,0,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.ToastBorderColor}"/>

                            <TextBlock Text="Border Thickness:" Margin="0,10,0,5"/>
                            <TextBlock Text="Set to 0 to disable border." FontSize="10" Foreground="Gray" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.ToastBorderThickness}"
                                        Minimum="0" Maximum="5" Width="200"
                                        TickFrequency="0.5" IsSnapToTickEnabled="True"/>
                                <TextBlock Text="{Binding Settings.ToastBorderThickness, StringFormat={}{0:F1} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                            </StackPanel>

                            <TextBlock Text="Border Opacity:" Margin="0,10,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.ToastBorderOpacity}"
                                        Minimum="0" Maximum="255" Width="200"/>
                                <TextBlock Text="{Binding Settings.ToastBorderOpacity, StringFormat={}{0}}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="40"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Accent Bar Section -->
                    <TextBlock Text="Accent Bar" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Show accent bar on left side"
                                     IsChecked="{Binding Settings.EnableToastAccentBar}"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="Accent Bar Thickness:" Margin="0,5,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Value="{Binding Settings.ToastAccentBarThickness}"
                                        Minimum="1" Maximum="10" Width="200"
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>
                                <TextBlock Text="{Binding Settings.ToastAccentBarThickness, StringFormat={}{0} px}"
                                          Margin="10,0,0,0" VerticalAlignment="Center" Width="50"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Colors Section -->
                    <TextBlock Text="Colors" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Accent/Title Color:" Margin="0,0,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.ToastAccentColor}"/>

                            <TextBlock Text="Text Color:" Margin="0,10,0,5"/>
                            <controls:ColorPickerButton SelectedColor="{Binding Settings.ToastTextColor}"/>
                        </StackPanel>
                    </Border>

                    <!-- Preview Button -->
                    <Button Content="Preview Toast"
                           Command="{Binding PreviewToastCommand}"
                           HorizontalAlignment="Left"
                           Padding="15,8"
                           Margin="0,10,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Troubleshooting Tab -->
        <TabItem Header="Troubleshooting">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Troubleshooting" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                    <!-- First: Enable Controller Input -->
                    <TextBlock Text="First: Enable Controller Input" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#1A3D2A" BorderBrush="#4CAF50" BorderThickness="2" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="&#x2714; Step 1: Enable Controller Input in Playnite" FontWeight="Bold" Foreground="#81C784" Margin="0,0,0,8"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,8">
                                For ControlUp to properly work, enable controller input in Playnite:
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                1. Open Playnite Settings
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                2. Go to Input
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#FFD180" FontWeight="SemiBold" Margin="0,0,0,5">
                                3. Enable "game controller API support"
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,0">
                                4. Click Save
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#B0B0B0" Margin="0,10,0,0" FontStyle="Italic">
                                Note: This setting is disabled by default in Playnite.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- SmartScreen Issue -->
                    <TextBlock Text="Fullscreen Mode Won't Launch" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Symptom:" FontWeight="SemiBold" Foreground="#FFB74D" Margin="0,0,0,5"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,0,0,10">
                                The popup closes after pressing Yes, but fullscreen mode never appears. Desktop mode may close but nothing happens.
                            </TextBlock>

                            <TextBlock Text="Cause:" FontWeight="SemiBold" Foreground="#FFB74D" Margin="0,0,0,5"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,0,0,10">
                                Windows SmartScreen may be blocking Playnite.FullscreenApp.exe because ControlUp launches it as a new process.
                            </TextBlock>

                            <TextBlock Text="Solution:" FontWeight="SemiBold" Foreground="#81C784" Margin="0,0,0,5"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                1. Navigate to your Playnite installation folder
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                2. Right-click on Playnite.FullscreenApp.exe and select Properties
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                3. At the bottom of the General tab, check the "Unblock" checkbox if present
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                4. Click Apply and OK
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,10,0,0" FontStyle="Italic">
                                Alternatively, run Playnite.FullscreenApp.exe manually once and click "Run anyway" when SmartScreen prompts.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Controller Mode Recommendation -->
                    <TextBlock Text="Controller Input Modes" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="XInput vs DirectInput" FontWeight="SemiBold" Foreground="#64B5F6" Margin="0,0,0,8"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,0,0,10">
                                Many third-party controllers (8BitDo, PowerA, etc.) support multiple input modes. For best performance with ControlUp, use XInput mode when available.
                            </TextBlock>

                            <TextBlock Text="XInput Mode (Recommended)" FontWeight="SemiBold" Foreground="#81C784" Margin="0,5,0,5"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="10,0,0,5">
                                • Fastest response time and lowest CPU usage
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="10,0,0,5">
                                • Native Windows support, no extra drivers needed
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="10,0,0,5">
                                • Best game compatibility
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="10,0,0,10">
                                • Full hotkey support with Guide button
                            </TextBlock>

                            <TextBlock Text="DirectInput / SDL Mode" FontWeight="SemiBold" Foreground="#FFB74D" Margin="0,5,0,5"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="10,0,0,5">
                                • Supported via SDL fallback (works but slower)
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="10,0,0,5">
                                • Higher CPU usage due to SDL polling
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="10,0,0,10">
                                • Some button mappings may vary
                            </TextBlock>

                            <TextBlock Text="How to Switch Modes (8BitDo Example):" FontWeight="SemiBold" Foreground="#64B5F6" Margin="0,10,0,5"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,0,0,10">
                                Most 8BitDo controllers switch modes by holding a button while powering on. Check your controller's manual for the specific combination (often X+Start for XInput mode).
                            </TextBlock>

                            <TextBlock Text="Note: PlayStation Controllers" FontWeight="SemiBold" Foreground="#CE93D8" Margin="0,5,0,5"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0">
                                DualSense (PS5) and DualShock 4 (PS4) controllers do not support XInput mode. They use DirectInput only and are detected via SDL. Expect a slight delay when registering hotkeys compared to XInput controllers.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Hotkey Not Working -->
                    <TextBlock Text="Hotkey Not Working" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Check These:" FontWeight="SemiBold" Foreground="#FFB74D" Margin="0,0,0,8"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                1. Ensure "Enable controller hotkey" is checked in General settings
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                2. Use the "Detect Controllers" button in the Diagnostics tab to verify your controller is recognized
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                3. For Guide/PS button hotkeys, try enabling "Require long press"
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                4. If using DirectInput mode, hotkeys work via SDL fallback (may have slight delay)
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,10,0,0" FontStyle="Italic">
                                For non-Xbox controllers, XInput mode provides the most reliable hotkey detection.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- XInput Controller #1 Display -->
                    <TextBlock Text="&quot;XInput Controller #1&quot; Name" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Why am I seeing this name?" FontWeight="SemiBold" Foreground="#64B5F6" Margin="0,0,0,8"/>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,0,0,10">
                                If your controller is showing as "XInput Controller #1" (or #2, #3, etc.) instead of its actual name, this is normal and nothing is functionally wrong.
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                ControlUp displays the controller name as reported by Playnite's SDK. When using XInput mode, Windows doesn't provide detailed device names - it only identifies controllers by their slot number.
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,10,0,0" FontStyle="Italic">
                                You can verify this by checking Playnite's Settings → Input, which shows the same generic names.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Log Files -->
                    <TextBlock Text="Getting Help" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0" Margin="0,0,0,10">
                                If you're still having issues, enable detailed logging and check the log files:
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,5">
                                • ControlUp.log - Extension folder (click "Open Extension Folder" in General tab)
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#E0E0E0" Margin="0,0,0,10">
                                • playnite.log - %AppData%\Playnite\playnite.log
                            </TextBlock>
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#B0B0B0">
                                Report issues with log files at: github.com/aHuddini/ControlUp/issues
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Diagnostics Tab -->
        <TabItem Header="Diagnostics">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Diagnostics" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                    <!-- Logging Section -->
                    <TextBlock Text="Logging" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Enable detailed logging"
                                     IsChecked="{Binding Settings.EnableLogging}"/>
                            <TextBlock Text="Logs controller detection, hotkey presses, and other diagnostic information to ControlUp.log"
                                      FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Controller Detection Section -->
                    <TextBlock Text="Controller Detection" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Scan for connected controllers and adapters to verify detection."
                                      FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,10"/>
                            <Button Content="Detect Controllers"
                                   Command="{Binding DetectControllersCommand}"
                                   HorizontalAlignment="Left"
                                   Padding="10,5"
                                   Margin="0,0,0,10"/>
                            <TextBox Text="{Binding DetectedControllersText}"
                                    IsReadOnly="True"
                                    TextWrapping="Wrap"
                                    VerticalScrollBarVisibility="Auto"
                                    Height="150"
                                    FontFamily="Consolas"
                                    FontSize="10"/>
                        </StackPanel>
                    </Border>

                    <!-- Extension Folder -->
                    <TextBlock Text="Extension Files" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                    <Border Background="#2D2D30" BorderBrush="#3F3F46" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Open the extension folder to access log files and configuration."
                                      FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,10"/>
                            <Button Content="Open Extension Folder"
                                   Command="{Binding OpenLogsFolderCommand}"
                                   HorizontalAlignment="Left"
                                   Padding="10,5"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
    </TabControl>
</UserControl>
